#!/usr/bin/env ruby

Petra::CLI.start( ARGV.dup )

BEGIN {
  begin
    has_retried = false
    require 'petra/cli'
  rescue LoadError => e
    raise e if has_retried

    rootdir = File.expand_path "#{ __FILE__ }/../.."
    gitdir  = "#{ rootdir }/.git"

    if Dir.exists?( gitdir )
      ENV[ 'BUNDLE_GEMFILE' ] ||= "#{ rootdir }/Gemfile"
      require 'bundler/setup'
    end

    has_retried = true
    retry
  end
}
